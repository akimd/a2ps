%%Page: (1) 1
%%BeginPageSetup
/pagesave save def
%%EndPageSetup
iso1dict begin
(Test Files) 35.25 water
gsave
llx lly 12 add translate
/v 0 store
/x0 x v get 4.703931 add sx cw mul add store
/y0 y v get bfs th add sub store
x0 y0 moveto
(#! /bin/sh -e) c n
(# -*- ksh -*-) N
() p n
(# psmandup --- produce a version of a PS file to print in manual Duplex.) c n
() p n
(# Copyright \(c\) 1998, 1999 Akim Demaille, Miguel Santana) c n
() p n
(# This program is free software; you can redistribute it and/or modify) c n
(# it under the terms of the GNU General Public License as published by) N
(# the Free Software Foundation; either version 3, or \(at your option\)) N
(# any later version.) N
(#) N
(# This program is distributed in the hope that it will be useful,) N
(# but WITHOUT ANY WARRANTY; without even the implied warranty of) N
(# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the) N
(# GNU General Public License for more details.) N
(#) N
(# You should have received a copy of the GNU General Public License) N
(# along with this program; if not, you can either send email to this) N
(# program's maintainer or write to: The Free Software Foundation,) N
(# Inc.; 59 Temple Place, Suite 330; Boston, MA 02111-1307, USA.) N
() p n
(# Author: Akim Demaille <Akim.Demaille@freefriends.org>) c n
() p n
(# Get the name of the program) c n
(program=`echo $0 | sed ') p
(s#.*/##g) str
('`) p n
() N
(# Local vars) c n
(address=0) p 16 T () S
(# Where to put the manual feed feature) c n
(back=:) p 8 T () S 16 T () S
(# Print the back side pages.) c n
(debug=) p n
(file=) N
(front=:) S 8 T () S 16 T () S
(# Print the front side pages.) c n
(output=-) p 16 T () S
(# Default is stdout) c n
(fixps=${FIXPS:-fixps}) p n
(message=) N
(psselect=${PSSELECT:-psselect}) N
(psset=${PSSET:-psset}) N
(tmpdir=`mktemp -d -t psmandup.XXXXXX` || { echo ") S
($program: Cannot create temporary dir!) str
(" >&) p n
(2 ; ) S
(exit) K
( 1; }) p n
() N
(# These two must be kept in synch.  They are opposed.) c n
(verbose=echo) p n
(quiet=:) N
() N
(# The version/usage strings) c n
(version=") p
(psmandup 2.1 \(GNU a2ps 4.13c\)) str n
(Written by Akim Demaille.) N
() N
(Copyright \(c\) 1998-1999 Akim Demaille, Miguel Santana) N
(This is free software; see the source for copying conditions.  There is NO) N
(warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.) S
(") p n
() N
(usage=") S
(\\) str n
(Usage: $program FILE) N
(Tries to produce a version of the PostScript FILE to print in manual) N
(Duplex.) N
() N
(Options:) N
( -h, --help           display this help and exit) N
( -v, --version        display version information and exit) N
( -q, --quiet          don't print informational messages) N
( -o, --output=FILE    save result in FILE.  If FILE is \\`-', send to stdout) N
( -n, --no-fix         don't call fixps to fix PS problems in FILE) N
( -f, --front          output only the front pages \(recto\) on the regular) N
(                      tray) N
(psmandup) (right) (1) title
border
grestore
(The room for the header) rhead
(Printed by Somebody from a machine) (Right) (1) footer
end % of iso1dict
pagesave restore
showpage
%%Page: (2) 2
%%BeginPageSetup
/pagesave save def
%%EndPageSetup
iso1dict begin
(Test Files) 35.25 water
gsave
llx lly 12 add translate
/v 0 store
/x0 x v get 4.703931 add sx cw mul add store
/y0 y v get bfs th add sub store
x0 y0 moveto
( -b, --back           output only the back pages \(verso\) on the manual) str n
(                      feed tray) N
() N
(Produced output is meant for PS level 2 printers which don't support) N
(Duplex printing, but support Manual Feed.  Once the first set of pages) N
(is printed \(odd pages\), manual feed is asked: introduce the odd pages) N
(to print the even pages on the other side.) N
() N
(Because there is usually a short time out for manually fed jobs, you) N
(should really be next to the printer.  If ever the time out expired,) N
(use the option -b to send only the missing part.) N
() N
(Environment variables FIXPS, PSSELECT and PSSET, if defined, are used) N
(to find the tools.) N
() N
(News, updates and documentation: http://www.inf.enst.fr/~demaille/a2ps/) N
(Report bugs to <bug-a2ps@gnu.org>) S
(") p n
() N
(help=") S
(Try \\`$program --help' for more information.) str
(") p n
() N
(# Parse command line arguments.) c n
(option_without_arguments=') p
(vhsqnDbf) str
(') p n
() N
(# Push a token among the arguments that will be used to notice when) c n
(# we ended options/arguments parsing.) N
(arg_sep=") p
($$--$$) str
(") p n
(set) K
( dummy ${1+") p
($@) str
("} ") p
($arg_sep) str
(") p n
(shift) K n
(while) S
( ) p
(test) K
( ") p
(x$1) str
(" != ") p
(x$arg_sep) str
("; ) p
(do) K n
() p n
(  ) S
(# Handle --option=value by splitting apart and putting back on argv.) c n
(  ) p
(case) K
( ") p
($1) str
(" ) p
(in) K n
(    --*=*\)) p n
(      opt=`echo ") S
($1) str
(" | sed -e ') p
(s/=.*//) str
('`) p n
(      val=`echo ") S
($1) str
(" | sed -e ') p
(s/[^=]*=//) str
('`) p n
(      ) S
(shift) K n
(      ) p
(set) K
( dummy ") p
($opt) str
(" ") p
($val) str
(" ${1+") p
($@) str
("}) p n
(      ) S
(shift) K n
(      ;;) p n
() N
(    -[$option_without_arguments]?*\)) N
(      ) S
(# Prefix $1 with x to avoid running `echo -na' for instance.) c n
(      opt=`echo ") p
(x$1) str
(" | sed -e ') p
(s/x-\\\(.\\\).*/-\\1/) str
('`) p n
(      rest=`echo ") S
(x$1) str
(" | sed -e ') p
(s/x-.\\\(.*\\\)/-\\1/) str
('`) p n
(      ) S
(shift) K n
(      ) p
(set) K
( dummy ") p
($opt) str
(" ") p
($rest) str
(" ${1+") p
($@) str
("}) p n
(      ) S
(shift) K n
(      ;;) p n
() N
(    ) S
(# This case needs to be protected so that the case `-??*' does) c n
(    ) p
(# not split long options without arguments) c n
(    --*\)) p n
(      ;;) N
() N
(    ) S
(# This is an option with argument.  Split apart and put back on argv.) c n
(    -??*\)) p n
(      opt=`echo ") S
(x$1) str
(" | sed -e ') p
(s/x-\\\(.\\\).*/-\\1/) str
('`) p n
(      arg=`echo ") S
(x$1) str
(" | sed -e ') p
(s/x-.\\\(.*\\\)/\\1/) str
('`) p n
(      ) S
(shift) K n
(      ) p
(set) K
( dummy ") p
($opt) str
(" ") p
($arg) str
(" ${1+") p
($@) str
("}) p n
(      ) S
(shift) K n
(      ;;) p n
(  ) S
(esac) K n
() p n
(  ) S
(# Now, handle the options.  $1 is the option *only*.  If it has an) c n
(  ) p
(# argument, it is now necessarily in $2 etc.  Remember to shift) c n
(psmandup) (right) (2) title
border
grestore
(The room for the header) rhead
(Printed by Somebody from a machine) (Right) (2) footer
end % of iso1dict
pagesave restore
showpage
%%Page: (3) 3
%%BeginPageSetup
/pagesave save def
%%EndPageSetup
iso1dict begin
(Test Files) 35.25 water
gsave
llx lly 12 add translate
/v 0 store
/x0 x v get 4.703931 add sx cw mul add store
/y0 y v get bfs th add sub store
x0 y0 moveto
(  ) p
(# when fetching an argument.) c n
(  ) p
(case) K
( ") p
($1) str
(" ) p
(in) K n
(    -v | --v*\) echo ") p
($version) str
("; ) p
(exit) K
( 0;;) p n
(    -h | --h*\) echo ") S
($usage) str
("; ) p
(exit) K
( 0;;) p n
(    -q | -s | --s* | --q*\) verbose=:; quiet=echo;;) N
(    ) S
(# Delay debugging so that options parsing does not appear) c n
(    -D | --deb*\) debug=-D ;;) p n
(    -o | --out*\) ) S
(shift) K
( ; output=$1 ;;) p n
(    -b | --bac*\) front= ; back=: ;;) N
(    -f | --fro*\) front=: ; back= ;;) N
(    -\) ) S
(# We are working with stdin ;;) c n
(       ) p
(set) K
( dummy ") p
($@) str
(" ") p
($1) str
(") p n
(       ) S
(shift) K n
(       ;;) p n
(    -n | --no*\) fixps= ;;) N
() N
(    --\) ) S
(# What remains are not options.) c n
(      ) p
(shift) K n
(      ) p
(while) K
( ) p
(test) K
( ") p
(x$1) str
(" != ") p
(x$arg_sep) str
("; ) p
(do) K n
(        ) p
(set) K
( dummy ${1+") p
($@) str
("} ") p
($1) str
(") p n
(        ) S
(shift) K n
() p 8 T () S
(shift) K n
(      ) p
(done) K n
(      ) p
(break) K
(;;) p n
() N
(    -*\)) N
(      echo ") S
($program: Unknown or ambiguous option \\`$1'.) str
(" >&2) p n
(      echo ") S
($program: Try \\`--help' for more information.) str
(" >&2) p n
(      ) S
(exit) K
( 1;;) p n
(    *\) ) S
(set) K
( dummy ${1+") p
($@) str
("} ") p
($1) str
(") p n
(       ) S
(shift) K n
(       ;;) p n
(   ) S
(esac) K n
(   ) p
(shift) K n
(done) N
(# Pop the token) c n
(shift) K n
() p n
() N
(# Check the number of arguments.) c n
(case) K
( $# ) p
(in) K n
(  0\)  file=-;;) p n
(  1\)  file=$1;;) N
(  *\)  echo ") S
($program: too many arguments) str
(" 1>&2) p n
(      echo ") S
($help) str
("  1>&2) p n
(      ) S
(exit) K
( 1;;) p n
(esac) K n
() p n
(if) K
( ) p
(test) K
( -n ") p
($debug) str
("; ) p
(then) K n
(  ) p
(# Set -x now if debugging) c n
(  ) p
(set) K
( -x) p n
(else) K n
(  ) p
(# Temp dir.  Get ready not to leave junk \(if not debugging\)) c n
(  ) p
(trap) K
( ") p
(/bin/rm -rf $tmpdir) str
(" 0 1 2 3 13 15) p n
(fi) K n
() p n
(# If printing from stdin, save into a tmp file) c n
(if) K
( ) p
(test) K
( $file = ') p
(-) str
('; ) p
(then) K n
(  file=$tmpdir/stdin.ps) p n
(  cat > $file) N
(fi) K n
() p n
(# Fix the file beforehand, so that we can really expect to find the) c n
(# page numbers.) N
(if) K
( ) p
(test) K
( -n ") p
($fixps) str
("; ) p
(then) K n
(  $fixps $file -o $tmpdir/fixed.ps `$quiet -q`) p n
(psmandup) (right) (3) title
border
grestore
(The room for the header) rhead
(Printed by Somebody from a machine) (Right) (3) footer
end % of iso1dict
pagesave restore
showpage
%%Page: (4) 4
%%BeginPageSetup
/pagesave save def
%%EndPageSetup
iso1dict begin
(Test Files) 35.25 water
gsave
llx lly 12 add translate
/v 0 store
/x0 x v get 4.703931 add sx cw mul add store
/y0 y v get bfs th add sub store
x0 y0 moveto
(  file=$tmpdir/fixed.ps) p n
(fi) K n
() p n
(# Get the number of pages of the document) c n
(pagenum=`sed -ne ') p
(/^%%Pages:/{) str n
(s/%%Pages: \\\\\([0-9]*\\\\\).*$/\\\\1/p) N
(q) N
(}) S
(' $file`) p n
() N
(# Make the string to get the front pages \(even, increasing\) if needed) c n
(if) K
( ) p
(test) K
( -n ") p
($front) str
("; ) p
(then) K n
(  evens=") p
(1) str
(") p n
(  i=3) N
(  ) S
(# Build the string to give to psselect) c n
(  ) p
(while) K
( ) p
(test) K
( $i -le $pagenum;) p n
(  ) S
(do) K n
(    evens=") p
($evens,$i) str
(") p n
(    i=`expr $i + 2`) N
(  ) S
(done) K n
(fi) N
() p n
(# Make the string to get the back pages \(odd, decreasing\) if needed) c n
(if) K
( ) p
(test) K
( -n ") p
($back) str
("; ) p
(then) K n
(  ) p
(# If the number of pages is odd, we need to insert a blank sheet) c n
(  ) p
(case) K
( ") p
($pagenum) str
(" ) p
(in) K n
(    *[13579]\)) p n
(      odds=") S
(_) str
(") p n
(      i=`expr $pagenum - 1 || ) S
(exit) K
( 0`) p n
(      ;;) N
(    *\) ) S
(# Odd, and not 0, so at least >= 2) c n
(       odds=$pagenum) p n
(       i=`expr $pagenum - 2 || ) S
(exit) K
( 0`) p n
(       ;;) N
(  ) S
(esac) K n
() p n
(  ) S
(# Make the string to get the second half \(odd, decreasing\)) c n
(  ) p
(while) K
( ) p
(test) K
( $i != 0;) p n
(  ) S
(do) K n
(    odds=") p
($odds,$i) str
(") p n
(    i=`expr $i - 2 || ) S
(exit) K
( 0`) p n
(  ) S
(done) K n
(fi) N
() p n
(# If there are both odds and evens to print, the separator is `,') c n
(test) K
( -n ") p
($odds) str
(" && ) p
(test) K
( -n ") p
($evens) str
(" && separator=,) p n
() N
(# Reorder the pages) c n
($psselect -q $evens$separator$odds $file > $tmpdir/ordered.ps) p n
() N
(# If needed, insert the manual feed request) c n
(if) K
( ) p
(test) K
( -n ") p
($back) str
("; ) p
(then) K n
(  ) p
(# The option of psset to ask the manual feed.  If not set,) c n
(  ) p
(# psset just does nothing.) c n
(  pssetmanfeed=-m) p n
(  ) S
(# Compute the address, depending on front pages are printed or not.) c n
(  ) p
(if) K
( ) p
(test) K
( -n ") p
($front) str
("; ) p
(then) K n
(    address=`expr ') p
(\() str
(' $pagenum + 1 ') p
(\)) str
(' / 2 + 1`) p n
(    message=") S
(\\) str n
(Once the first half of the file printed, insert the sheets stack into) N
(the manual feed tray to print the second half.  Be aware the time out) N
(if usually short.  If it expired, use option -b to proceed.) S
(") p n
(  ) S
(else) K n
(    address=0) p n
(    message=") S
(Insert the front pages stack into the manual feed tray.) str
(") p n
(  ) S
(fi) K n
(fi) N
(psmandup) (right) (4) title
border
grestore
(The room for the header) rhead
(Printed by Somebody from a machine) (Right) (4) footer
end % of iso1dict
pagesave restore
showpage
%%Page: (5) 5
%%BeginPageSetup
/pagesave save def
%%EndPageSetup
iso1dict begin
(Test Files) 35.25 water
gsave
llx lly 12 add translate
/v 0 store
/x0 x v get 4.703931 add sx cw mul add store
/y0 y v get bfs th add sub store
x0 y0 moveto
() p n
(# Insert the manual feed request if needed) c n
($psset -n $pssetmanfeed -a $address -o$output $tmpdir/ordered.ps $debug) p n
() N
(test) K
( -n ") p
($message) str
(" && $verbose ") p
($message) str
(" 1>&2) p n
(exit) K
( 0) p n
(psmandup) (right) (5) title
border
grestore
(The room for the header) rhead
(Printed by Somebody from a machine) (Right) (5) footer
end % of iso1dict
pagesave restore
showpage

%%Trailer
end
%%EOF
